const target = document.getElementById('js-target');
let input = document.getElementById('js-input');
let enter_key = "";
let playing = false;

const questions = [];
const answers = [];
for (let i = 0; i < gon.commands.length; i++) { questions.push(gon.commands[`${i}`].question) };
for (let i = 0; i < gon.commands.length; i++) { answers.push(gon.commands[`${i}`].answer_key) };

const ignore_keys = ['Shift', 'Tab', 'Enter', 'Escape', 'Meta', 'Alt', 'Dead']

function set_question() {
  question = String(questions.splice(0, 1));
  answer = String(answers.splice(0, 1));
  target.textContent = question;
  input.textContent = "";
  enter_key = "";
}

document.addEventListener('keydown', e => {
  if (e.key === ' ' && playing === true) {
    return;
  } else if (e.key === ' ' && playing === false) {
    playing = true;
    set_question();
  }
})

document.addEventListener('keydown', e=> {
  if (e.key === ' ' && playing === true || playing === false || ignore_keys.includes(e.key)) {
    return;
  }
  if (e.key === 'Backspace') {
    enter_key = enter_key.slice(0, -1);
  } else if (e.key === 'Control') {
    enter_key += e.key + "+";
  }
  else {
    enter_key += e.key;
  }
  input.textContent = enter_key;
  if (enter_key === answer) {
    if (questions.length === 0) {
      const result = document.getElementById('js-result');
      result.textContent = '終了しました!';
      return;
    }
    alert('OKOK!!!');
    set_question();
  }
})
